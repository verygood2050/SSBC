<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„œì„œìš¸ì„±ì„œì¹¨ë¡€êµíšŒ</title>
    <meta name="theme-color" content="#1e3a5f">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK - ë°˜ë“œì‹œ ë¨¼ì € ë¡œë“œ -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Mammoth.js for docx parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d5a8a;
            --primary-dark: #0f1f33;
            --accent: #c9a227;
            --bg-warm: #faf8f5;
            --bg-card: #ffffff;
            --text-primary: #2c2c2c;
            --text-secondary: #666666;
            --text-light: #999999;
            --border: #e8e4de;
            --shadow: rgba(30, 58, 95, 0.08);
            --success: #4a9d6e;
            --danger: #c75050;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-warm);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content { max-width: 600px; margin: 0 auto; position: relative; }

        .church-name {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .church-subtitle { font-size: 0.75rem; opacity: 0.8; }

        .connection-status {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
        }

        .status-dot.connected { background: var(--success); }

        .settings-btn {
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1rem;
            cursor: pointer;
            color: white;
        }

        .settings-btn:hover { background: rgba(255,255,255,0.3); }

        .admin-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 4px 12px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .settings-section {
            background: var(--bg-warm);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .settings-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .admin-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-status span {
            font-weight: 500;
        }

        .admin-status .btn {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .security-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #fff8e6;
            border-radius: 8px;
            border: 1px solid var(--accent);
        }

        .security-status.secure {
            background: #e8f5e9;
            border-color: var(--success);
        }

        .security-icon { font-size: 1.2rem; }

        .guide-step {
            padding: 12px;
            border-left: 3px solid var(--primary);
            margin-bottom: 12px;
            background: var(--bg-warm);
        }

        .guide-step h4 {
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .guide-step p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .guide-step a {
            color: var(--primary);
        }

        .code-block {
            background: var(--primary-dark);
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            white-space: pre;
        }

        .admin-required-notice {
            background: #fff8e6;
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            color: var(--accent);
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .main-content { max-width: 600px; margin: 0 auto; padding: 20px; }

        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px var(--shadow);
            border: 1px solid var(--border);
        }

        .card-title {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .welcome-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .welcome-card .card-title { color: white; justify-content: center; font-size: 1.3rem; }

        .daily-verse {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
            line-height: 1.8;
            margin: 16px 0;
        }

        .verse-reference { font-size: 0.85rem; opacity: 0.8; }

        .quick-links { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }

        .quick-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px 8px;
            background: var(--bg-card);
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-primary);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .quick-link .link-icon { font-size: 1.8rem; margin-bottom: 6px; }
        .quick-link .link-text { font-size: 0.8rem; font-weight: 500; }

        .add-link-btn {
            border: 2px dashed var(--border) !important;
            background: transparent !important;
            color: var(--text-light) !important;
        }

        .link-edit-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.7rem;
            cursor: pointer;
            opacity: 0.8;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .link-edit-btn:hover { opacity: 1; }

        .notice-item {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            position: relative;
        }

        .notice-item:last-child { border-bottom: none; }
        .notice-item:hover { background: var(--bg-warm); }

        .notice-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .notice-title { font-weight: 500; flex: 1; }
        .notice-date { font-size: 0.8rem; color: var(--text-light); }

        .notice-badge {
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 8px;
        }

        .notice-delete {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.6;
            padding: 4px;
        }

        .notice-delete:hover { opacity: 1; }

        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .month-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .current-month {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .prayer-item {
            background: var(--bg-warm);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent);
            position: relative;
        }

        .prayer-author { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px; }
        .prayer-content { font-size: 0.95rem; line-height: 1.6; }
        .prayer-date { font-size: 0.75rem; color: var(--text-light); margin-top: 8px; text-align: right; }

        .prayer-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 4px;
        }

        .prayer-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            opacity: 0.5;
            font-size: 1rem;
        }

        .prayer-actions button:hover { opacity: 1; }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
        }

        .calendar-day-name { font-size: 0.75rem; color: var(--text-light); padding: 8px 0; }
        .calendar-day-name:first-child { color: var(--danger); }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
        }

        .calendar-day:hover { background: var(--bg-warm); }
        .calendar-day.today { background: var(--primary); color: white; }
        .calendar-day.selected { background: var(--accent); color: white; }
        .calendar-day.other-month { opacity: 0.3; cursor: pointer; }
        .calendar-day.other-month:hover { opacity: 0.6; background: var(--bg-warm); }
        .calendar-day.sunday { color: var(--danger); }
        .calendar-day.today.sunday, .calendar-day.selected.sunday { color: white; }

        /* ì¼ì • ìˆëŠ” ë‚  - ë¹¨ê°„ ì  */
        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            box-shadow: 0 0 4px #e74c3c;
        }

        .calendar-day.today.has-event::after,
        .calendar-day.selected.has-event::after { 
            background: #ffeb3b;
            box-shadow: 0 0 4px #ffeb3b;
        }

        .selected-date-info {
            background: var(--bg-warm);
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
        }

        .selected-date-title { font-weight: 600; color: var(--primary); margin-bottom: 12px; }

        .schedule-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg-warm);
            border-radius: 10px;
            margin-bottom: 8px;
            align-items: center;
        }

        .schedule-date { min-width: 50px; text-align: center; }
        .schedule-day { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .schedule-weekday { font-size: 0.75rem; color: var(--text-light); }
        .schedule-info { flex: 1; }
        .schedule-title { font-weight: 500; margin-bottom: 4px; }
        .schedule-time { font-size: 0.85rem; color: var(--text-secondary); }

        .dept-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .dept-manage-btn {
            padding: 6px 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 0.8rem;
            cursor: pointer;
            font-family: inherit;
        }

        .dept-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 12px;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .dept-tab {
            flex-shrink: 0;
            padding: 8px 16px;
            background: var(--bg-warm);
            border: none;
            border-radius: 20px;
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .dept-tab.active { background: var(--primary); color: white; }

        .dept-post {
            background: var(--bg-warm);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .dept-post.locked { border: 2px solid var(--accent); }

        .dept-post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .dept-post-title { font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 6px; }
        .dept-post-date { font-size: 0.8rem; color: var(--text-light); }
        .dept-post-preview { font-size: 0.9rem; color: var(--text-secondary); }

        .lock-icon { color: var(--accent); }

        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 8px; }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            background: white;
        }

        .form-textarea { min-height: 100px; resize: vertical; }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--bg-warm);
            border-radius: 10px;
            cursor: pointer;
        }

        .form-checkbox input { width: 18px; height: 18px; }

        .password-field {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: #fff8e6;
            border-radius: 10px;
            border: 1px solid var(--accent);
        }

        .password-field.active { display: block; }

        .password-field label {
            display: block;
            font-size: 0.85rem;
            color: var(--accent);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .password-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-block { width: 100%; }
        .btn-group { display: flex; gap: 8px; }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 20px var(--shadow);
            border-top: 1px solid var(--border);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            color: var(--text-light);
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
        }

        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.4rem; }
        .nav-text { font-size: 0.65rem; font-weight: 500; }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
        }

        .modal-title {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .modal-close {
            background: var(--danger);
            border: none;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 8px;
        }

        .modal-body { padding: 20px; }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 4px;
            font-size: 1rem;
            opacity: 0.6;
        }

        .delete-btn:hover { opacity: 1; }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state .icon { font-size: 3rem; margin-bottom: 12px; }

        .icon-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .icon-option {
            padding: 10px;
            font-size: 1.5rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            background: white;
        }

        .icon-option:hover { border-color: var(--primary); }
        .icon-option.selected { background: var(--primary); border-color: var(--primary); }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-dark);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 0.9rem;
            z-index: 300;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.show { opacity: 1; }

        .comments-section {
            margin-top: 20px;
            border-top: 1px solid var(--border);
            padding-top: 16px;
        }

        .comments-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .comment-item {
            background: var(--bg-warm);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            position: relative;
        }

        .comment-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .comment-author { font-size: 0.85rem; font-weight: 500; color: var(--primary); }
        .comment-date { font-size: 0.75rem; color: var(--text-light); }
        .comment-content { font-size: 0.9rem; line-height: 1.5; }

        .comment-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            opacity: 0.5;
        }

        .comment-form {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .comment-form input[type="text"]:first-child { width: 80px; flex-shrink: 0; }

        .comment-form input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .comment-form button {
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .selected-schedule-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .mt-16 { margin-top: 16px; }
        .mb-16 { margin-bottom: 16px; }

        .password-prompt { text-align: center; padding: 20px; }
        .password-prompt .lock-big { font-size: 3rem; margin-bottom: 16px; }
        .password-prompt p { color: var(--text-secondary); margin-bottom: 16px; }

        .password-prompt input {
            width: 100%;
            max-width: 200px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 16px;
        }

        .password-error { color: var(--danger); font-size: 0.9rem; margin-bottom: 12px; display: none; }
        .password-error.show { display: block; }

        .quick-add-btn {
            width: 100%;
            padding: 12px;
            margin-top: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .dept-manage-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-warm);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .dept-manage-info { display: flex; align-items: center; gap: 10px; }
        .dept-manage-icon { font-size: 1.5rem; }
        .dept-manage-name { font-weight: 500; }
        .dept-manage-actions { display: flex; gap: 8px; }

        .dept-manage-actions button {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .dept-edit-btn { background: var(--primary); color: white; }
        .dept-delete-btn { background: var(--danger); color: white; }

        .admin-panel {
            display: none;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 2px solid var(--accent);
        }

        .admin-panel.show { display: block; }

        .admin-title { font-size: 0.9rem; font-weight: 700; color: var(--accent); margin-bottom: 12px; }

        .admin-toggle-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .calendar-legend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-top: 12px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
        .legend-dot.event { background: #e74c3c; }
        .legend-dot.today { background: var(--primary); }

        .verse-manage-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1rem;
            cursor: pointer;
            color: white;
        }

        .verse-manage-btn:hover { background: rgba(255,255,255,0.3); }

        .verse-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            align-items: center;
        }

        .verse-day {
            min-width: 40px;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
        }

        .verse-input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .verse-input-group input:first-of-type { flex: 2; }

        .verse-list-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .verse-quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .verse-quick-actions button {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-warm);
            cursor: pointer;
            font-size: 0.85rem;
        }

        .verse-quick-actions button:hover { background: var(--border); }

        .verse-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .verse-tab {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-warm);
            cursor: pointer;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .verse-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .verse-tab-content {
            display: none;
        }

        .verse-tab-content.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--bg-warm);
        }

        .upload-area .upload-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .divider-text {
            text-align: center;
            color: var(--text-light);
            margin: 16px 0;
            position: relative;
        }

        .divider-text::before,
        .divider-text::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: var(--border);
        }

        .divider-text::before { left: 0; }
        .divider-text::after { right: 0; }

        .parse-result {
            background: var(--bg-warm);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.9rem;
        }

        .parse-result.success { border-left: 4px solid var(--success); }
        .parse-result.error { border-left: 4px solid var(--danger); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="connection-status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">ì—°ê²° ì¤‘...</span>
            </div>
            <button class="settings-btn" onclick="openSettingsModal()">âš™ï¸</button>
            <h1 class="church-name">ì„œì„œìš¸ì„±ì„œì¹¨ë¡€êµíšŒ</h1>
            <p class="church-subtitle">West Seoul Bible Baptist Church</p>
            <div class="admin-badge" id="adminBadge" style="display:none;">ğŸ‘‘ ê´€ë¦¬ì</div>
        </div>
    </header>

    <main class="main-content">
        <section id="home" class="section active">
            <div class="card welcome-card" style="position:relative;">
                <button class="verse-manage-btn" onclick="openVerseModal()">âš™ï¸</button>
                <h2 class="card-title">âœï¸ ì˜¤ëŠ˜ì˜ ë§ì”€</h2>
                <p class="daily-verse" id="dailyVerse">"í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼"</p>
                <p class="verse-reference" id="verseReference">ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18</p>
            </div>
            <div class="card">
                <h3 class="card-title">â­ ì¦ê²¨ì°¾ê¸°</h3>
                <div class="quick-links" id="quickLinks"></div>
            </div>
            <div class="card">
                <h3 class="card-title">ğŸ“¢ ìµœê·¼ ê³µì§€</h3>
                <div id="recentNotices"></div>
            </div>
        </section>

        <section id="notice" class="section">
            <div class="card">
                <h3 class="card-title">ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
                <button class="admin-toggle-btn" onclick="togglePanel('noticeAdminPanel', this)">â• ê³µì§€ ë“±ë¡í•˜ê¸°</button>
                <div class="admin-panel" id="noticeAdminPanel">
                    <h4 class="admin-title">âš™ï¸ ê³µì§€ ë“±ë¡</h4>
                    <div class="form-group">
                        <label class="form-label">ì œëª©</label>
                        <input type="text" class="form-input" id="noticeTitle" placeholder="ê³µì§€ ì œëª©">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‚´ìš©</label>
                        <textarea class="form-textarea" id="noticeContent" placeholder="ê³µì§€ ë‚´ìš©"></textarea>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="noticeImportant"> ì¤‘ìš” ê³µì§€</label>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="addNotice()">ê³µì§€ ë“±ë¡</button>
                </div>
                <div id="noticeList"></div>
            </div>
        </section>

        <section id="prayer" class="section">
            <div class="card">
                <h3 class="card-title">ğŸ™ ê¸°ë„ì œëª©</h3>
                <div class="month-selector">
                    <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
                    <span class="current-month" id="currentMonth"></span>
                    <button class="month-btn" onclick="changeMonth(1)">â€º</button>
                </div>
                <button class="btn btn-primary btn-block mb-16" onclick="openPrayerModal()">âœï¸ ê¸°ë„ì œëª© ì˜¬ë¦¬ê¸°</button>
                <div id="prayerList"></div>
            </div>
        </section>

        <section id="schedule" class="section">
            <div class="card">
                <div class="calendar-header">
                    <button class="month-btn" onclick="changeCalendarMonth(-1)">â€¹</button>
                    <span class="current-month" id="calendarMonth"></span>
                    <button class="month-btn" onclick="changeCalendarMonth(1)">â€º</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div class="calendar-legend">
                    <div class="legend-item"><span class="legend-dot today"></span> ì˜¤ëŠ˜</div>
                    <div class="legend-item"><span class="legend-dot event"></span> ì¼ì • ìˆìŒ</div>
                </div>
                <div class="selected-date-info" id="selectedDateInfo" style="display:none;">
                    <div class="selected-date-title" id="selectedDateTitle"></div>
                    <div id="selectedDateSchedules"></div>
                    <button class="quick-add-btn" onclick="openQuickScheduleModal()">â• ì´ ë‚ ì§œì— ì¼ì • ì¶”ê°€</button>
                </div>
                <h4 class="card-title mt-16">ğŸ“‹ ì´ë²ˆ ë‹¬ ì¼ì •</h4>
                <div id="monthSchedules"></div>
            </div>
        </section>

        <section id="department" class="section">
            <div class="card">
                <div class="dept-header">
                    <h3 class="card-title" style="margin-bottom:0;">ğŸ‘¥ ë¶€ì„œ ê²Œì‹œíŒ</h3>
                    <button class="dept-manage-btn" onclick="openDeptManageModal()">âš™ï¸ ë¶€ì„œ ê´€ë¦¬</button>
                </div>
                <div class="dept-tabs" id="deptTabs"></div>
                <button class="admin-toggle-btn" onclick="togglePanel('deptAdminPanel', this)">â• ê²Œì‹œê¸€ ë“±ë¡í•˜ê¸°</button>
                <div class="admin-panel" id="deptAdminPanel">
                    <h4 class="admin-title">âš™ï¸ ê²Œì‹œê¸€ ë“±ë¡</h4>
                    <div class="form-group">
                        <label class="form-label">ë¶€ì„œ</label>
                        <select class="form-select" id="deptPostDept"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì œëª©</label>
                        <input type="text" class="form-input" id="deptPostTitle" placeholder="ì œëª©">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‚´ìš©</label>
                        <textarea class="form-textarea" id="deptPostContent" placeholder="ë‚´ìš©"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="deptPostLocked" onchange="togglePasswordField()">
                            <span>ğŸ”’ ë¹„ë°€ê¸€ë¡œ ì„¤ì •</span>
                        </label>
                        <div class="password-field" id="passwordField">
                            <label>ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</label>
                            <input type="text" id="deptPostPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                        </div>
                    </div>
                    <button class="btn btn-primary btn-block" onclick="addDeptPost()">ê²Œì‹œê¸€ ë“±ë¡</button>
                </div>
                <div id="deptContents"></div>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="showSection('home', this)"><span class="nav-icon">ğŸ </span><span class="nav-text">í™ˆ</span></button>
        <button class="nav-item" onclick="showSection('notice', this)"><span class="nav-icon">ğŸ“¢</span><span class="nav-text">ê³µì§€</span></button>
        <button class="nav-item" onclick="showSection('prayer', this)"><span class="nav-icon">ğŸ™</span><span class="nav-text">ê¸°ë„</span></button>
        <button class="nav-item" onclick="showSection('schedule', this)"><span class="nav-icon">ğŸ“…</span><span class="nav-text">ì¼ì •</span></button>
        <button class="nav-item" onclick="showSection('department', this)"><span class="nav-icon">ğŸ‘¥</span><span class="nav-text">ë¶€ì„œ</span></button>
    </nav>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div class="modal-overlay" id="prayerModal" onclick="if(event.target===this)closeModal('prayerModal')">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="prayerModalTitle">ê¸°ë„ì œëª© ì˜¬ë¦¬ê¸°</h3>
                <button class="modal-close" onclick="closeModal('prayerModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="prayerEditId">
                <div class="form-group">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" class="form-input" id="prayerAuthor" placeholder="ìµëª… ê°€ëŠ¥">
                </div>
                <div class="form-group">
                    <label class="form-label">ê¸°ë„ì œëª©</label>
                    <textarea class="form-textarea" id="prayerContent" placeholder="ê¸°ë„ì œëª©ì„ ë‚˜ëˆ ì£¼ì„¸ìš”"></textarea>
                </div>
                <button class="btn btn-primary btn-block" onclick="savePrayer()">ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="noticeModal" onclick="if(event.target===this)closeModal('noticeModal')">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="noticeModalTitle"></h3>
                <button class="modal-close" onclick="closeModal('noticeModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <p class="notice-date mb-16" id="noticeModalDate"></p>
                <div id="noticeModalContent" style="line-height: 1.8; white-space: pre-wrap;"></div>
                <div class="comments-section">
                    <h4 class="comments-title">ğŸ’¬ ëŒ“ê¸€ <span id="commentCount"></span></h4>
                    <div id="noticeComments"></div>
                    <div class="comment-form">
                        <input type="text" id="commentAuthor" placeholder="ì´ë¦„">
                        <input type="text" id="commentContent" placeholder="ëŒ“ê¸€ ì…ë ¥">
                        <button onclick="addComment()">ë“±ë¡</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="linkModal" onclick="if(event.target===this)closeModal('linkModal')">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="linkModalTitle">ì¦ê²¨ì°¾ê¸° ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeModal('linkModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="linkEditId">
                <div class="form-group">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" class="form-input" id="linkName" placeholder="ì˜ˆ: êµíšŒ ì¹´í˜">
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" class="form-input" id="linkUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">ì•„ì´ì½˜ ì„ íƒ</label>
                    <div class="icon-picker" id="iconPicker"></div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" style="flex:1" onclick="saveLink()">ì €ì¥</button>
                    <button class="btn btn-danger" id="deleteLinkBtn" style="display:none" onclick="deleteLink()">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="deptManageModal" onclick="if(event.target===this)closeModal('deptManageModal')">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">âš™ï¸ ë¶€ì„œ ê´€ë¦¬</h3>
                <button class="modal-close" onclick="closeModal('deptManageModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-primary btn-block mb-16" onclick="openDeptAddModal()">â• ìƒˆ ë¶€ì„œ ì¶”ê°€</button>
                <div id="deptManageList"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="deptModal" onclick="if(event.target===this)closeModal('deptModal')">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="deptModalTitle">ë¶€ì„œ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeModal('deptModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="deptEditId">
                <div class="form-group">
                    <label class="form-label">ë¶€ì„œ ì´ë¦„</label>
                    <input type="text" class="form-input" id="deptName" placeholder="ì˜ˆ: ì²­ë…„ë¶€">
                </div>
                <div class="form-group">
                    <label class="form-label">ì•„ì´ì½˜ ì„ íƒ</label>
                    <div class="icon-picker" id="deptIconPicker"></div>
                </div>
                <button class="btn btn-primary btn-block" onclick="saveDept()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="deptPostModal" onclick="if(event.target===this)closeModal('deptPostModal')">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="deptPostModalTitle"></h3>
                <button class="modal-close" onclick="closeModal('deptPostModal')">âœ•</button>
            </div>
            <div class="modal-body" id="deptPostModalBody"></div>
        </div>
    </div>

    <div class="modal-overlay" id="passwordModal" onclick="if(event.target===this)closeModal('passwordModal')">
        <div class="modal" style="max-width: 350px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ”’ ë¹„ë°€ê¸€</h3>
                <button class="modal-close" onclick="closeModal('passwordModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="password-prompt">
                    <div class="lock-big">ğŸ”</div>
                    <p>ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤</p>
                    <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" onkeypress="if(event.key==='Enter')checkPassword()">
                    <p class="password-error" id="passwordError">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤</p>
                    <button class="btn btn-primary btn-block" onclick="checkPassword()">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="quickScheduleModal" onclick="if(event.target===this)closeModal('quickScheduleModal')">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title" id="quickScheduleTitle">ğŸ“… ì¼ì • ë“±ë¡</h3>
                <button class="modal-close" onclick="closeModal('quickScheduleModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ì œëª©</label>
                    <input type="text" class="form-input" id="quickScheduleInput" placeholder="ì¼ì • ì œëª©">
                </div>
                <div class="form-group">
                    <label class="form-label">ì‹œê°„ (ì„ íƒ)</label>
                    <input type="text" class="form-input" id="quickScheduleTime" placeholder="ì˜ˆ: ì˜¤ì „ 11ì‹œ">
                </div>
                <button class="btn btn-primary btn-block" onclick="saveQuickSchedule()">ë“±ë¡</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="verseModal" onclick="if(event.target===this)closeModal('verseModal')">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“– ì˜¤ëŠ˜ì˜ ë§ì”€ ê´€ë¦¬</h3>
                <button class="modal-close" onclick="closeModal('verseModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <!-- íƒ­ ë©”ë‰´ -->
                <div class="verse-tabs">
                    <button class="verse-tab active" onclick="switchVerseTab('upload')">ğŸ“ íŒŒì¼/í…ìŠ¤íŠ¸ ì—…ë¡œë“œ</button>
                    <button class="verse-tab" onclick="switchVerseTab('manual')">âœï¸ ì§ì ‘ ì…ë ¥</button>
                </div>

                <!-- ì—…ë¡œë“œ íƒ­ -->
                <div id="verseUploadTab" class="verse-tab-content active">
                    <p style="color:var(--text-secondary); margin-bottom: 16px; font-size: 0.9rem;">
                        ğŸ“Œ Word íŒŒì¼(.docx), í…ìŠ¤íŠ¸ íŒŒì¼(.txt)ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
                    </p>
                    
                    <div class="upload-area" onclick="document.getElementById('verseFileInput').click()">
                        <input type="file" id="verseFileInput" accept=".docx,.txt" style="display:none" onchange="handleVerseFile(this)">
                        <div class="upload-icon">ğŸ“„</div>
                        <p>íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                        <p style="font-size:0.8rem; color:var(--text-light)">.docx, .txt íŒŒì¼ ì§€ì›</p>
                    </div>

                    <div class="divider-text">ë˜ëŠ” í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸°</div>

                    <textarea id="verseTextArea" class="form-textarea" style="min-height:200px;" placeholder="ì˜ˆì‹œ:
1ì›” 1ì¼ ëª©ìš”ì¼
ì‹œí¸ 90:12 ìš°ë¦¬ì—ê²Œ ìš°ë¦¬ ë‚  ê³„ìˆ˜í•¨ì„ ê°€ë¥´ì¹˜ì‚¬ ì§€í˜œë¡œìš´ ë§ˆìŒì„ ì–»ê²Œ í•˜ì†Œì„œ
1ì›” 2ì¼ ê¸ˆìš”ì¼
ë§ˆíƒœë³µìŒ 6:33 ê·¸ëŸ°ì¦‰ ë„ˆí¬ëŠ” ë¨¼ì € ê·¸ì˜ ë‚˜ë¼ì™€ ê·¸ì˜ ì˜ë¥¼ êµ¬í•˜ë¼..."></textarea>
                    
                    <button class="btn btn-primary btn-block mt-16" onclick="parseAndSaveVerses()">ğŸ“¥ ë§ì”€ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>

                <!-- ì§ì ‘ ì…ë ¥ íƒ­ -->
                <div id="verseManualTab" class="verse-tab-content">
                    <div class="verse-quick-actions">
                        <button onclick="clearAllVerses()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
                        <button onclick="loadSampleVerses()">ğŸ“ ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    </div>
                    <div class="verse-list-container" id="verseListContainer"></div>
                    <button class="btn btn-primary btn-block mt-16" onclick="saveAllVerses()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- ê´€ë¦¬ì ì¸ì¦ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="adminAuthModal">
        <div class="modal" style="max-width: 350px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ” ê´€ë¦¬ì ì¸ì¦</h3>
                <button class="modal-close" onclick="closeModal('adminAuthModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <p style="text-align:center; color:var(--text-secondary); margin-bottom:16px;">
                    ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”
                </p>
                <input type="password" class="form-input" id="adminPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" style="text-align:center; font-size:1.1rem;" onkeypress="if(event.key==='Enter')verifyAdminPassword()">
                <p class="password-error" id="adminPasswordError">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤</p>
                <button class="btn btn-primary btn-block mt-16" onclick="verifyAdminPassword()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="settingsModal" onclick="if(event.target===this)closeModal('settingsModal')">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3 class="modal-title">âš™ï¸ ì•± ì„¤ì •</h3>
                <button class="modal-close" onclick="closeModal('settingsModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <!-- ê´€ë¦¬ì ëª¨ë“œ ìƒíƒœ -->
                <div class="settings-section">
                    <h4 class="settings-title">ğŸ‘¤ ê´€ë¦¬ì ëª¨ë“œ</h4>
                    <div class="admin-status" id="adminStatusDisplay">
                        <span id="adminStatusText">ë¹„í™œì„±í™”</span>
                        <button class="btn btn-primary" id="adminToggleBtn" onclick="toggleAdminMode()">ë¡œê·¸ì¸</button>
                    </div>
                </div>

                <!-- ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œë§Œ) -->
                <div class="settings-section" id="adminPasswordSection" style="display:none;">
                    <h4 class="settings-title">ğŸ”‘ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h4>
                    <input type="password" class="form-input" id="newAdminPassword" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬ ì´ìƒ)">
                    <button class="btn btn-primary btn-block mt-16" onclick="changeAdminPassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                </div>

                <!-- ë°ì´í„° ë°±ì—… -->
                <div class="settings-section">
                    <h4 class="settings-title">ğŸ’¾ ë°ì´í„° ë°±ì—…</h4>
                    <p style="font-size:0.85rem; color:var(--text-secondary); margin-bottom:12px;">
                        ëª¨ë“  ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.
                    </p>
                    <button class="btn btn-primary btn-block" onclick="backupData()">ğŸ“¥ ë°±ì—… ë‹¤ìš´ë¡œë“œ</button>
                </div>

                <!-- ë°ì´í„° ë³µì› (ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œë§Œ) -->
                <div class="settings-section" id="restoreSection" style="display:none;">
                    <h4 class="settings-title">ğŸ“¤ ë°ì´í„° ë³µì›</h4>
                    <p style="font-size:0.85rem; color:var(--text-secondary); margin-bottom:12px;">
                        ë°±ì—… íŒŒì¼ì—ì„œ ë°ì´í„°ë¥¼ ë³µì›í•©ë‹ˆë‹¤.
                    </p>
                    <input type="file" id="restoreFileInput" accept=".json" style="display:none" onchange="restoreData(this)">
                    <button class="btn btn-block" style="background:var(--accent);color:white;" onclick="document.getElementById('restoreFileInput').click()">ğŸ“¤ ë°±ì—… íŒŒì¼ ì„ íƒ</button>
                </div>

                <!-- Firebase ë³´ì•ˆ ê·œì¹™ ì•ˆë‚´ -->
                <div class="settings-section">
                    <h4 class="settings-title">ğŸ”’ ë³´ì•ˆ ìƒíƒœ</h4>
                    <div id="securityStatus" class="security-status">
                        <span class="security-icon">âš ï¸</span>
                        <span>ë³´ì•ˆ ê·œì¹™ì„ ì„¤ì •í•´ì£¼ì„¸ìš”</span>
                    </div>
                    <button class="btn btn-block mt-16" style="background:var(--text-secondary);color:white;" onclick="showSecurityGuide()">ë³´ì•ˆ ì„¤ì • ê°€ì´ë“œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë³´ì•ˆ ê°€ì´ë“œ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="securityGuideModal" onclick="if(event.target===this)closeModal('securityGuideModal')">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ”’ Firebase ë³´ì•ˆ ì„¤ì • ê°€ì´ë“œ</h3>
                <button class="modal-close" onclick="closeModal('securityGuideModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="guide-step">
                    <h4>1ë‹¨ê³„: Firebase Console ì ‘ì†</h4>
                    <p><a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a> ì ‘ì†</p>
                </div>
                <div class="guide-step">
                    <h4>2ë‹¨ê³„: í”„ë¡œì íŠ¸ ì„ íƒ</h4>
                    <p>church-app-cce2f í”„ë¡œì íŠ¸ í´ë¦­</p>
                </div>
                <div class="guide-step">
                    <h4>3ë‹¨ê³„: ê·œì¹™ ì„¤ì •</h4>
                    <p>Realtime Database â†’ ê·œì¹™(Rules) íƒ­ í´ë¦­</p>
                </div>
                <div class="guide-step">
                    <h4>4ë‹¨ê³„: ì•„ë˜ ê·œì¹™ ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°</h4>
                    <pre class="code-block">{
  "rules": {
    ".read": true,
    ".write": true,
    "settings": {
      ".write": true
    }
  }
}</pre>
                    <button class="btn btn-block mt-16" onclick="copySecurityRules()">ğŸ“‹ ê·œì¹™ ë³µì‚¬</button>
                </div>
                <div class="guide-step">
                    <h4>5ë‹¨ê³„: ê²Œì‹œ(Publish) ë²„íŠ¼ í´ë¦­</h4>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        var db = null;
        var currentPrayerMonth = new Date();
        var currentCalendarMonth = new Date();
        var selectedDate = null;
        var currentDept = null;
        var selectedIcon = 'ğŸ”—';
        var selectedDeptIcon = 'ğŸ‘”';
        var currentNoticeId = null;
        var pendingPost = null;

        var notices = [];
        var prayers = [];
        var schedules = [];
        var links = [];
        var departments = [];
        var deptPosts = {};
        var comments = {};
        var dailyVerses = {};
        
        // ê´€ë¦¬ì ì„¤ì •
        var adminPassword = null; // Firebaseì—ì„œ ë¡œë“œ
        var isAdminMode = false;

        var linkIcons = ['ğŸ”—', 'â˜•', 'ğŸ“º', 'ğŸ“–', 'ğŸµ', 'ğŸ“·', 'ğŸ’¬', 'ğŸ“§', 'ğŸŒ', 'ğŸ“±', 'ğŸ ', 'â›ª'];
        var deptIcons = ['ğŸ‘”', 'ğŸ‘—', 'ğŸŒŸ', 'ğŸ“', 'ğŸ§’', 'ğŸµ', 'ğŸ“š', 'ğŸº', 'ğŸ¹', 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', 'ğŸ‘´', 'ğŸ‘µ', 'ğŸ’’', 'âœï¸', 'ğŸ“–', 'ğŸ™'];

        var verses = [
            { text: "í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼", reference: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18" },
            { text: "ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤", reference: "ì‹œí¸ 23:1" },
            { text: "ë‘ë ¤ì›Œí•˜ì§€ ë§ë¼ ë‚´ê°€ ë„ˆì™€ í•¨ê»˜ í•¨ì´ë¼", reference: "ì´ì‚¬ì•¼ 41:10" }
        ];

        // ========== Firebase ì´ˆê¸°í™” ==========
        var firebaseConfig = {
            apiKey: "AIzaSyA7zoDte4aKn8IJXpkmYYSL9hHWlrQlp-c",
            authDomain: "church-app-cce2f.firebaseapp.com",
            databaseURL: "https://church-app-cce2f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "church-app-cce2f"
        };

        // Firebase ì¦‰ì‹œ ì´ˆê¸°í™”
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            console.log('Firebase ì´ˆê¸°í™” ì„±ê³µ');
        } catch(e) {
            console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
        }

        // ========== í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            
            if (db) {
                // ì—°ê²° ìƒíƒœ í™•ì¸
                db.ref('.info/connected').on('value', function(snap) {
                    var connected = snap.val() === true;
                    document.getElementById('statusDot').className = 'status-dot' + (connected ? ' connected' : '');
                    document.getElementById('statusText').textContent = connected ? 'ì‹¤ì‹œê°„ ì—°ê²°ë¨' : 'ì˜¤í”„ë¼ì¸';
                });

                // ë°ì´í„° ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                setupListeners();
            } else {
                document.getElementById('statusText').textContent = 'ì—°ê²° ì‹¤íŒ¨';
            }

            // UI ì´ˆê¸°í™”
            initIconPickers();
            setDailyVerse();
        });

        // ========== ë°ì´í„° ë¦¬ìŠ¤ë„ˆ ==========
        function setupListeners() {
            // ê³µì§€
            db.ref('notices').on('value', function(snap) {
                notices = [];
                snap.forEach(function(c) { notices.unshift({ id: c.key, ...c.val() }); });
                renderNotices();
                renderRecentNotices();
            });

            // ê¸°ë„ì œëª©
            db.ref('prayers').on('value', function(snap) {
                prayers = [];
                snap.forEach(function(c) { prayers.unshift({ id: c.key, ...c.val() }); });
                renderPrayers();
            });

            // ì¼ì •
            db.ref('schedules').on('value', function(snap) {
                schedules = [];
                snap.forEach(function(c) { schedules.push({ id: c.key, ...c.val() }); });
                console.log('ì¼ì • ë¡œë“œ:', schedules.length);
                renderCalendar();
                renderSchedules();
                if (selectedDate) showSelectedDateSchedules();
            });

            // ì¦ê²¨ì°¾ê¸°
            db.ref('links').on('value', function(snap) {
                links = [];
                snap.forEach(function(c) { links.push({ id: c.key, ...c.val() }); });
                console.log('ì¦ê²¨ì°¾ê¸° ë¡œë“œ:', links.length);
                renderQuickLinks();
            });

            // ë¶€ì„œ
            db.ref('departments').on('value', function(snap) {
                departments = [];
                snap.forEach(function(c) { departments.push({ id: c.key, ...c.val() }); });
                departments.sort(function(a, b) { return (a.order || 0) - (b.order || 0); });
                console.log('ë¶€ì„œ ë¡œë“œ:', departments.length, departments);
                
                if (departments.length > 0 && (!currentDept || !departments.find(function(d) { return d.id === currentDept; }))) {
                    currentDept = departments[0].id;
                }
                if (departments.length === 0) currentDept = null;
                
                renderDeptTabs();
                updateDeptSelect();
                renderDeptPosts();
            });

            // ë¶€ì„œ ê²Œì‹œê¸€
            db.ref('deptPosts').on('value', function(snap) {
                deptPosts = {};
                snap.forEach(function(dept) {
                    deptPosts[dept.key] = [];
                    dept.forEach(function(post) {
                        deptPosts[dept.key].unshift({ id: post.key, ...post.val() });
                    });
                });
                renderDeptPosts();
            });

            // ëŒ“ê¸€
            db.ref('comments').on('value', function(snap) {
                comments = {};
                snap.forEach(function(c) {
                    comments[c.key] = [];
                    c.forEach(function(comment) {
                        comments[c.key].push({ id: comment.key, ...comment.val() });
                    });
                });
                if (currentNoticeId) renderComments(currentNoticeId);
            });

            // ì˜¤ëŠ˜ì˜ ë§ì”€
            db.ref('dailyVerses').on('value', function(snap) {
                dailyVerses = {};
                snap.forEach(function(c) {
                    dailyVerses[c.key] = c.val();
                });
                console.log('ë§ì”€ ë¡œë“œ:', Object.keys(dailyVerses).length + 'ê°œ');
                displayTodayVerse();
            });

            // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
            db.ref('settings/adminPassword').on('value', function(snap) {
                adminPassword = snap.val();
                console.log('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸:', adminPassword ? 'ì„¤ì •ë¨' : 'ë¯¸ì„¤ì •');
                if (!adminPassword) {
                    // ì²« ì‚¬ìš© ì‹œ ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì•ˆë‚´
                    console.log('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”');
                }
            });
        }

        // ========== ìœ í‹¸ë¦¬í‹° ==========
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        
        function showSection(id, btn) {
            document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); });
            if (btn) btn.classList.add('active');
        }

        function togglePanel(panelId, btn) {
            var panel = document.getElementById(panelId);
            panel.classList.toggle('show');
            btn.textContent = panel.classList.contains('show') ? 'âœ• ë‹«ê¸°' : 'â• ' + (panelId === 'noticeAdminPanel' ? 'ê³µì§€ ë“±ë¡í•˜ê¸°' : 'ê²Œì‹œê¸€ ë“±ë¡í•˜ê¸°');
        }

        function showToast(msg) {
            var t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(function() { t.classList.remove('show'); }, 2000);
        }

        function formatDate(str) {
            if (!str) return '';
            var d = new Date(str);
            return (d.getMonth()+1) + '/' + d.getDate();
        }

        // ========== ê´€ë¦¬ì ê¸°ëŠ¥ ==========
        var pendingAdminAction = null;

        function openSettingsModal() {
            updateAdminStatusDisplay();
            openModal('settingsModal');
        }

        function updateAdminStatusDisplay() {
            var statusText = document.getElementById('adminStatusText');
            var toggleBtn = document.getElementById('adminToggleBtn');
            var badge = document.getElementById('adminBadge');
            var passwordSection = document.getElementById('adminPasswordSection');
            var restoreSection = document.getElementById('restoreSection');

            if (isAdminMode) {
                statusText.textContent = 'âœ… í™œì„±í™”ë¨';
                statusText.style.color = 'var(--success)';
                toggleBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                toggleBtn.style.background = 'var(--danger)';
                badge.style.display = 'inline-block';
                passwordSection.style.display = 'block';
                restoreSection.style.display = 'block';
            } else {
                statusText.textContent = 'ë¹„í™œì„±í™”';
                statusText.style.color = 'var(--text-secondary)';
                toggleBtn.textContent = 'ë¡œê·¸ì¸';
                toggleBtn.style.background = 'var(--primary)';
                badge.style.display = 'none';
                passwordSection.style.display = 'none';
                restoreSection.style.display = 'none';
            }
        }

        function toggleAdminMode() {
            if (isAdminMode) {
                // ë¡œê·¸ì•„ì›ƒ
                isAdminMode = false;
                updateAdminStatusDisplay();
                showToast('ê´€ë¦¬ì ëª¨ë“œê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            } else {
                // ë¡œê·¸ì¸ ì‹œë„
                if (!adminPassword) {
                    // ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° - ì²« ì„¤ì •
                    var newPw = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì²˜ìŒ ì„¤ì •í•©ë‹ˆë‹¤.\n4ìë¦¬ ì´ìƒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                    if (newPw && newPw.length >= 4) {
                        db.ref('settings/adminPassword').set(newPw).then(function() {
                            adminPassword = newPw;
                            isAdminMode = true;
                            updateAdminStatusDisplay();
                            showToast('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
                        });
                    } else if (newPw) {
                        showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                    }
                } else {
                    // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
                    document.getElementById('adminPasswordInput').value = '';
                    document.getElementById('adminPasswordError').classList.remove('show');
                    pendingAdminAction = 'login';
                    openModal('adminAuthModal');
                }
            }
        }

        function verifyAdminPassword() {
            var input = document.getElementById('adminPasswordInput').value;
            
            if (input === adminPassword) {
                closeModal('adminAuthModal');
                
                if (pendingAdminAction === 'login') {
                    isAdminMode = true;
                    updateAdminStatusDisplay();
                    showToast('ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
                } else if (pendingAdminAction && typeof pendingAdminAction === 'function') {
                    pendingAdminAction();
                }
                pendingAdminAction = null;
            } else {
                document.getElementById('adminPasswordError').classList.add('show');
                document.getElementById('adminPasswordInput').value = '';
            }
        }

        function requireAdmin(action) {
            if (isAdminMode) {
                action();
            } else if (!adminPassword) {
                // ë¹„ë°€ë²ˆí˜¸ ë¯¸ì„¤ì • ì‹œ ììœ  ì ‘ê·¼ (ì²« ì‚¬ìš©)
                action();
            } else {
                pendingAdminAction = action;
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('adminPasswordError').classList.remove('show');
                openModal('adminAuthModal');
            }
        }

        function changeAdminPassword() {
            var newPw = document.getElementById('newAdminPassword').value.trim();
            if (newPw.length < 4) {
                showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤');
                return;
            }
            
            db.ref('settings/adminPassword').set(newPw).then(function() {
                adminPassword = newPw;
                document.getElementById('newAdminPassword').value = '';
                showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        // ========== ë°±ì—…/ë³µì› ==========
        function backupData() {
            if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
            
            db.ref().once('value').then(function(snap) {
                var data = snap.val();
                var backup = {
                    exportDate: new Date().toISOString(),
                    appVersion: 'v10',
                    data: data
                };
                
                var blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'church-backup-' + new Date().toISOString().split('T')[0] + '.json';
                a.click();
                URL.revokeObjectURL(url);
                
                showToast('ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        function restoreData(input) {
            var file = input.files[0];
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var backup = JSON.parse(e.target.result);
                    
                    if (!backup.data) {
                        showToast('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤');
                        return;
                    }

                    if (!confirm('ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.\nì •ë§ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        return;
                    }

                    db.ref().set(backup.data).then(function() {
                        showToast('ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤');
                        closeModal('settingsModal');
                    }).catch(function(err) {
                        showToast('ë³µì› ì‹¤íŒ¨: ' + err.message);
                    });
                } catch (err) {
                    showToast('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨');
                }
            };
            reader.readAsText(file);
        }

        function showSecurityGuide() {
            openModal('securityGuideModal');
        }

        function copySecurityRules() {
            var rules = '{\n  "rules": {\n    ".read": true,\n    ".write": true,\n    "settings": {\n      ".write": true\n    }\n  }\n}';
            navigator.clipboard.writeText(rules).then(function() {
                showToast('ê·œì¹™ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
            }).catch(function() {
                showToast('ë³µì‚¬ ì‹¤íŒ¨ - ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”');
            });
        }

        function formatDateTime(str) {
            if (!str) return '';
            var d = new Date(str);
            return d.getFullYear() + 'ë…„ ' + (d.getMonth()+1) + 'ì›” ' + d.getDate() + 'ì¼';
        }

        function setDailyVerse() {
            // Firebaseì—ì„œ ë¡œë“œëœ ë§ì”€ì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©
            displayTodayVerse();
        }

        function displayTodayVerse() {
            var today = new Date().getDate();
            var verse = dailyVerses[today];
            
            if (verse && verse.text) {
                document.getElementById('dailyVerse').textContent = '"' + verse.text + '"';
                document.getElementById('verseReference').textContent = verse.reference || '';
            } else {
                // ê¸°ë³¸ ë§ì”€ (Firebaseì— ë°ì´í„°ê°€ ì—†ì„ ë•Œ)
                var defaultVerses = [
                    { text: "í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼", reference: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18" },
                    { text: "ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤", reference: "ì‹œí¸ 23:1" },
                    { text: "ë‘ë ¤ì›Œí•˜ì§€ ë§ë¼ ë‚´ê°€ ë„ˆì™€ í•¨ê»˜ í•¨ì´ë¼", reference: "ì´ì‚¬ì•¼ 41:10" }
                ];
                var idx = today % defaultVerses.length;
                document.getElementById('dailyVerse').textContent = '"' + defaultVerses[idx].text + '"';
                document.getElementById('verseReference').textContent = defaultVerses[idx].reference;
            }
        }

        function openVerseModal() {
            renderVerseInputs();
            openModal('verseModal');
        }

        function switchVerseTab(tab) {
            document.querySelectorAll('.verse-tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.verse-tab-content').forEach(function(c) { c.classList.remove('active'); });
            
            if (tab === 'upload') {
                document.querySelector('.verse-tab:first-child').classList.add('active');
                document.getElementById('verseUploadTab').classList.add('active');
            } else {
                document.querySelector('.verse-tab:last-child').classList.add('active');
                document.getElementById('verseManualTab').classList.add('active');
                renderVerseInputs();
            }
        }

        function handleVerseFile(input) {
            var file = input.files[0];
            if (!file) return;

            var fileName = file.name.toLowerCase();
            
            if (fileName.endsWith('.docx')) {
                // Word íŒŒì¼ ì²˜ë¦¬
                var reader = new FileReader();
                reader.onload = function(e) {
                    mammoth.extractRawText({ arrayBuffer: e.target.result })
                        .then(function(result) {
                            document.getElementById('verseTextArea').value = result.value;
                            showToast('íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. "ë§ì”€ ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
                        })
                        .catch(function(err) {
                            console.error('docx íŒŒì‹± ì—ëŸ¬:', err);
                            showToast('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨');
                        });
                };
                reader.readAsArrayBuffer(file);
            } else if (fileName.endsWith('.txt')) {
                // í…ìŠ¤íŠ¸ íŒŒì¼ ì²˜ë¦¬
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('verseTextArea').value = e.target.result;
                    showToast('íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. "ë§ì”€ ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
                };
                reader.readAsText(file, 'UTF-8');
            } else {
                showToast('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤');
            }
        }

        function parseAndSaveVerses() {
            var text = document.getElementById('verseTextArea').value.trim();
            if (!text) {
                showToast('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');
                return;
            }

            var lines = text.split('\n').map(function(l) { return l.trim(); }).filter(function(l) { return l; });
            var parsedVerses = {};
            var currentDay = null;

            for (var i = 0; i < lines.length; i++) {
                var line = lines[i];
                
                // ë‚ ì§œ íŒ¨í„´ ì°¾ê¸°: "1ì›” 1ì¼", "1ì¼", "01ì¼" ë“±
                var dayMatch = line.match(/(\d{1,2})ì›”\s*(\d{1,2})ì¼/) || line.match(/^(\d{1,2})ì¼/);
                
                if (dayMatch) {
                    // ë‚ ì§œ ì¤„ ë°œê²¬
                    currentDay = parseInt(dayMatch[dayMatch.length - 1]);
                } else if (currentDay && line.length > 5) {
                    // ë§ì”€ ì¤„ (ë‚ ì§œê°€ ì„¤ì •ëœ ìƒíƒœì—ì„œ ì¶©ë¶„íˆ ê¸´ í…ìŠ¤íŠ¸)
                    // ì¶œì²˜ì™€ ë‚´ìš© ë¶„ë¦¬: "ì‹œí¸ 90:12 ìš°ë¦¬ì—ê²Œ..." ë˜ëŠ” "ë§ˆíƒœë³µìŒ 6:33 ê·¸ëŸ°ì¦‰..."
                    var verseMatch = line.match(/^([ê°€-í£]+\s*\d+:\d+[-\d]*)\s+(.+)$/);
                    
                    if (verseMatch) {
                        parsedVerses[currentDay] = {
                            reference: verseMatch[1],
                            text: verseMatch[2]
                        };
                    } else {
                        // ì¶œì²˜ íŒ¨í„´ì´ ë‹¤ë¥¼ ê²½ìš° ì „ì²´ë¥¼ í…ìŠ¤íŠ¸ë¡œ
                        parsedVerses[currentDay] = {
                            reference: '',
                            text: line
                        };
                    }
                    currentDay = null; // ë‹¤ìŒ ë‚ ì§œë¥¼ ê¸°ë‹¤ë¦¼
                }
            }

            var count = Object.keys(parsedVerses).length;
            
            if (count === 0) {
                showToast('ë§ì”€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Firebaseì— ì €ì¥ (ê´€ë¦¬ì ì¸ì¦ í•„ìš”)
            requireAdmin(function() {
                if (!db) {
                    showToast('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨');
                    return;
                }

                db.ref('dailyVerses').set(parsedVerses).then(function() {
                    showToast(count + 'ê°œ ë§ì”€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    document.getElementById('verseTextArea').value = '';
                    closeModal('verseModal');
                }).catch(function(e) {
                    console.error('ì €ì¥ ì‹¤íŒ¨:', e);
                    showToast('ì €ì¥ ì‹¤íŒ¨');
                });
            });
        }

        function renderVerseInputs() {
            var container = document.getElementById('verseListContainer');
            var html = '';
            
            for (var day = 1; day <= 31; day++) {
                var verse = dailyVerses[day] || { text: '', reference: '' };
                html += '<div class="verse-input-group">';
                html += '<span class="verse-day">' + day + 'ì¼</span>';
                html += '<input type="text" id="verseText' + day + '" placeholder="ë§ì”€ ë‚´ìš©" value="' + (verse.text || '').replace(/"/g, '&quot;') + '">';
                html += '<input type="text" id="verseRef' + day + '" placeholder="ì¶œì²˜" value="' + (verse.reference || '').replace(/"/g, '&quot;') + '" style="flex:1;">';
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function saveAllVerses() {
            requireAdmin(function() {
                if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
                
                var versesToSave = {};
                var count = 0;
                
                for (var day = 1; day <= 31; day++) {
                    var text = document.getElementById('verseText' + day).value.trim();
                    var reference = document.getElementById('verseRef' + day).value.trim();
                    
                    if (text) {
                        versesToSave[day] = { text: text, reference: reference };
                        count++;
                    }
                }
                
                db.ref('dailyVerses').set(versesToSave).then(function() {
                    showToast(count + 'ê°œ ë§ì”€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    closeModal('verseModal');
                }).catch(function(e) {
                    console.error('ì €ì¥ ì‹¤íŒ¨:', e);
                    showToast('ì €ì¥ ì‹¤íŒ¨');
                });
            });
        }

        function clearAllVerses() {
            if (!confirm('ëª¨ë“  ë§ì”€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            for (var day = 1; day <= 31; day++) {
                document.getElementById('verseText' + day).value = '';
                document.getElementById('verseRef' + day).value = '';
            }
            showToast('ì…ë ¥ë€ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function loadSampleVerses() {
            var samples = [
                { text: "í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼", reference: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18" },
                { text: "ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤", reference: "ì‹œí¸ 23:1" },
                { text: "ë‘ë ¤ì›Œí•˜ì§€ ë§ë¼ ë‚´ê°€ ë„ˆì™€ í•¨ê»˜ í•¨ì´ë¼", reference: "ì´ì‚¬ì•¼ 41:10" },
                { text: "ë„ˆí¬ ì—¼ë ¤ë¥¼ ë‹¤ ì£¼ê»˜ ë§¡ê¸°ë¼ ì´ëŠ” ê·¸ê°€ ë„ˆí¬ë¥¼ ëŒë³´ì‹¬ì´ë¼", reference: "ë² ë“œë¡œì „ì„œ 5:7" },
                { text: "ë‚´ê°€ ë„ˆë¥¼ ê°•í•˜ê²Œ í•˜ë¦¬ë¼ ì°¸ìœ¼ë¡œ ë„ˆë¥¼ ë„ì™€ì£¼ë¦¬ë¼", reference: "ì´ì‚¬ì•¼ 41:10" },
                { text: "ì£¼ëŠ” ë‚˜ì˜ ë¹›ì´ìš” ë‚˜ì˜ êµ¬ì›ì´ì‹œë‹ˆ ë‚´ê°€ ëˆ„êµ¬ë¥¼ ë‘ë ¤ì›Œí•˜ë¦¬ìš”", reference: "ì‹œí¸ 27:1" },
                { text: "í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì´ì²˜ëŸ¼ ì‚¬ë‘í•˜ì‚¬ ë…ìƒìë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ", reference: "ìš”í•œë³µìŒ 3:16" },
                { text: "ë‚´ê°€ ì§„ì‹¤ë¡œ ë„ˆí¬ì—ê²Œ ì´ë¥´ë…¸ë‹ˆ ë¬´ì—‡ì´ë“ ì§€ ê¸°ë„í•˜ê³  êµ¬í•˜ëŠ” ê²ƒì€ ë°›ì€ ì¤„ë¡œ ë¯¿ìœ¼ë¼", reference: "ë§ˆê°€ë³µìŒ 11:24" },
                { text: "ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼ ì´ê²ƒì´ ê·¸ë¦¬ìŠ¤ë„ ì˜ˆìˆ˜ ì•ˆì—ì„œ ë„ˆí¬ë¥¼ í–¥í•˜ì‹  í•˜ë‚˜ë‹˜ì˜ ëœ»ì´ë‹ˆë¼", reference: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:18" },
                { text: "ë‚˜ì˜ í•˜ë‚˜ë‹˜ì´ ê·¸ë¦¬ìŠ¤ë„ ì˜ˆìˆ˜ ì•ˆì—ì„œ ì˜ê´‘ ê°€ìš´ë° ê·¸ í’ì„±í•œ ëŒ€ë¡œ ë„ˆí¬ ëª¨ë“  ì“¸ ê²ƒì„ ì±„ìš°ì‹œë¦¬ë¼", reference: "ë¹Œë¦½ë³´ì„œ 4:19" },
                { text: "ì£¼ë¥¼ ì•™ë§í•˜ëŠ” ìëŠ” ìƒˆ í˜ì„ ì–»ìœ¼ë¦¬ë‹ˆ ë…ìˆ˜ë¦¬ê°€ ë‚ ê°œì¹˜ë©° ì˜¬ë¼ê° ê°™ì„ ê²ƒì´ìš”", reference: "ì´ì‚¬ì•¼ 40:31" },
                { text: "ì—¬í˜¸ì™€ë¥¼ ê¸°ë»í•˜ë¼ ê·¸ê°€ ë„¤ ë§ˆìŒì˜ ì†Œì›ì„ ë„¤ê²Œ ì´ë£¨ì–´ ì£¼ì‹œë¦¬ë¡œë‹¤", reference: "ì‹œí¸ 37:4" },
                { text: "ì´ë¥´ì‹œë˜ ë‚´ ì€í˜œê°€ ë„¤ê²Œ ì¡±í•˜ë„ë‹¤ ì´ëŠ” ë‚´ ëŠ¥ë ¥ì´ ì•½í•œ ë°ì„œ ì˜¨ì „í•˜ì—¬ì§ì´ë¼", reference: "ê³ ë¦°ë„í›„ì„œ 12:9" },
                { text: "í‰ì•ˆì„ ë„ˆí¬ì—ê²Œ ë¼ì¹˜ë…¸ë‹ˆ ê³§ ë‚˜ì˜ í‰ì•ˆì„ ë„ˆí¬ì—ê²Œ ì£¼ë…¸ë¼", reference: "ìš”í•œë³µìŒ 14:27" },
                { text: "ë‚´ê°€ ë„ˆí¬ì—ê²Œ ë¶„ë¶€í•œ ê²ƒì„ ê°€ë¥´ì³ ì§€í‚¤ê²Œ í•˜ë¼ ë³¼ì§€ì–´ë‹¤ ë‚´ê°€ ì„¸ìƒ ëë‚ ê¹Œì§€ ë„ˆí¬ì™€ í•­ìƒ í•¨ê»˜ ìˆìœ¼ë¦¬ë¼", reference: "ë§ˆíƒœë³µìŒ 28:20" },
                { text: "ì˜¤ì§ ì„±ë ¹ì˜ ì—´ë§¤ëŠ” ì‚¬ë‘ê³¼ í¬ë½ê³¼ í™”í‰ê³¼ ì˜¤ë˜ ì°¸ìŒê³¼ ìë¹„ì™€ ì–‘ì„ ê³¼ ì¶©ì„±ê³¼ ì˜¨ìœ ì™€ ì ˆì œë‹ˆ", reference: "ê°ˆë¼ë””ì•„ì„œ 5:22-23" },
                { text: "ë„ˆí¬ëŠ” ì„¸ìƒì˜ ë¹›ì´ë¼ ì‚° ìœ„ì— ìˆëŠ” ë™ë„¤ê°€ ìˆ¨ê²¨ì§€ì§€ ëª»í•  ê²ƒì´ìš”", reference: "ë§ˆíƒœë³µìŒ 5:14" },
                { text: "ë¯¿ìŒì€ ë°”ë¼ëŠ” ê²ƒë“¤ì˜ ì‹¤ìƒì´ìš” ë³´ì´ì§€ ì•ŠëŠ” ê²ƒë“¤ì˜ ì¦ê±°ë‹ˆ", reference: "íˆë¸Œë¦¬ì„œ 11:1" },
                { text: "ë„¤ ì‹œì‘ì€ ë¯¸ì•½í•˜ì˜€ìœ¼ë‚˜ ë„¤ ë‚˜ì¤‘ì€ ì‹¬íˆ ì°½ëŒ€í•˜ë¦¬ë¼", reference: "ìš¥ê¸° 8:7" },
                { text: "ë‚˜ëŠ” í¬ë„ë‚˜ë¬´ìš” ë„ˆí¬ëŠ” ê°€ì§€ë¼ ê·¸ê°€ ë‚´ ì•ˆì—, ë‚´ê°€ ê·¸ ì•ˆì— ê±°í•˜ë©´ ì‚¬ëŒì´ ì—´ë§¤ë¥¼ ë§ì´ ë§ºë‚˜ë‹ˆ", reference: "ìš”í•œë³µìŒ 15:5" },
                { text: "ë„ˆí¬ ë§ˆìŒì— ê·¸ë¦¬ìŠ¤ë„ì˜ í‰ê°•ì´ ë‹¤ìŠ¤ë¦¬ê²Œ í•˜ë¼", reference: "ê³¨ë¡œìƒˆì„œ 3:15" },
                { text: "ì„¸ìƒì—ì„œëŠ” ë„ˆí¬ê°€ í™˜ë‚œì„ ë‹¹í•˜ë‚˜ ë‹´ëŒ€í•˜ë¼ ë‚´ê°€ ì„¸ìƒì„ ì´ê¸°ì—ˆë…¸ë¼", reference: "ìš”í•œë³µìŒ 16:33" },
                { text: "ìš°ë¦¬ê°€ ì•Œê±°ë‹ˆì™€ í•˜ë‚˜ë‹˜ì„ ì‚¬ë‘í•˜ëŠ” ì ê³§ ê·¸ì˜ ëœ»ëŒ€ë¡œ ë¶€ë¥´ì‹¬ì„ ì…ì€ ìë“¤ì—ê²ŒëŠ” ëª¨ë“  ê²ƒì´ í•©ë ¥í•˜ì—¬ ì„ ì„ ì´ë£¨ëŠë‹ˆë¼", reference: "ë¡œë§ˆì„œ 8:28" },
                { text: "ë„¤ê°€ ë§Œì¼ ë¯¿ìœ¼ë©´ í•˜ë‚˜ë‹˜ì˜ ì˜ê´‘ì„ ë³´ë¦¬ë¼", reference: "ìš”í•œë³µìŒ 11:40" },
                { text: "í•˜ë‚˜ë‹˜ì€ ì‚¬ë‘ì´ì‹œë¼", reference: "ìš”í•œì¼ì„œ 4:8" },
                { text: "ë‚´ê°€ ê³§ ê¸¸ì´ìš” ì§„ë¦¬ìš” ìƒëª…ì´ë‹ˆ ë‚˜ë¡œ ë§ë¯¸ì•”ì§€ ì•Šê³ ëŠ” ì•„ë²„ì§€ê»˜ë¡œ ì˜¬ ìê°€ ì—†ëŠë‹ˆë¼", reference: "ìš”í•œë³µìŒ 14:6" },
                { text: "ì£¼ ì˜ˆìˆ˜ë¥¼ ë¯¿ìœ¼ë¼ ê·¸ë¦¬í•˜ë©´ ë„ˆì™€ ë„¤ ì§‘ì´ êµ¬ì›ì„ ë°›ìœ¼ë¦¬ë¼", reference: "ì‚¬ë„í–‰ì „ 16:31" },
                { text: "ì—¬í˜¸ì™€ê»˜ì„œ ë„¤ê°€ ê°€ëŠ” ëª¨ë“  ê¸¸ì—ì„œ ë„ˆë¥¼ ì§€ì¼œ ì£¼ì‹œë¦¬ë¡œë‹¤", reference: "ì‹œí¸ 121:8" },
                { text: "ì²­í•¨ì„ ë°›ì€ ìëŠ” ë§ë˜ íƒí•¨ì„ ì…ì€ ìëŠ” ì ìœ¼ë‹ˆë¼", reference: "ë§ˆíƒœë³µìŒ 22:14" },
                { text: "ìˆ˜ê³ í•˜ê³  ë¬´ê±°ìš´ ì§ ì§„ ìë“¤ì•„ ë‹¤ ë‚´ê²Œë¡œ ì˜¤ë¼ ë‚´ê°€ ë„ˆí¬ë¥¼ ì‰¬ê²Œ í•˜ë¦¬ë¼", reference: "ë§ˆíƒœë³µìŒ 11:28" },
                { text: "ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤", reference: "ì‹œí¸ 23:1" }
            ];
            
            for (var day = 1; day <= 31; day++) {
                document.getElementById('verseText' + day).value = samples[day - 1].text;
                document.getElementById('verseRef' + day).value = samples[day - 1].reference;
            }
            showToast('ìƒ˜í”Œ ë§ì”€ì´ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤. ì €ì¥ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
        }

        // ========== ì•„ì´ì½˜ í”¼ì»¤ ==========
        function initIconPickers() {
            var linkPicker = document.getElementById('iconPicker');
            linkPicker.innerHTML = linkIcons.map(function(icon) {
                return '<div class="icon-option' + (icon === selectedIcon ? ' selected' : '') + '" onclick="selectLinkIcon(\'' + icon + '\')">' + icon + '</div>';
            }).join('');

            var deptPicker = document.getElementById('deptIconPicker');
            deptPicker.innerHTML = deptIcons.map(function(icon) {
                return '<div class="icon-option' + (icon === selectedDeptIcon ? ' selected' : '') + '" onclick="selectDeptIcon(\'' + icon + '\')">' + icon + '</div>';
            }).join('');
        }

        function selectLinkIcon(icon) {
            selectedIcon = icon;
            document.querySelectorAll('#iconPicker .icon-option').forEach(function(o) {
                o.classList.toggle('selected', o.textContent === icon);
            });
        }

        function selectDeptIcon(icon) {
            selectedDeptIcon = icon;
            document.querySelectorAll('#deptIconPicker .icon-option').forEach(function(o) {
                o.classList.toggle('selected', o.textContent === icon);
            });
        }

        // ========== ì¦ê²¨ì°¾ê¸° ==========
        function renderQuickLinks() {
            var html = links.map(function(l) {
                return '<a href="' + l.url + '" target="_blank" class="quick-link" style="position:relative;"><span class="link-icon">' + (l.icon || 'ğŸ”—') + '</span><span class="link-text">' + l.name + '</span><button class="link-edit-btn" onclick="event.preventDefault();event.stopPropagation();editLink(\'' + l.id + '\')">âœï¸</button></a>';
            }).join('');
            html += '<div class="quick-link add-link-btn" onclick="openLinkModal()"><span class="link-icon">â•</span><span class="link-text">ì¶”ê°€</span></div>';
            document.getElementById('quickLinks').innerHTML = html;
        }

        function openLinkModal() {
            document.getElementById('linkEditId').value = '';
            document.getElementById('linkName').value = '';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkModalTitle').textContent = 'ì¦ê²¨ì°¾ê¸° ì¶”ê°€';
            document.getElementById('deleteLinkBtn').style.display = 'none';
            selectedIcon = 'ğŸ”—';
            initIconPickers();
            openModal('linkModal');
        }

        function editLink(id) {
            var link = links.find(function(l) { return l.id === id; });
            if (!link) return;
            document.getElementById('linkEditId').value = id;
            document.getElementById('linkName').value = link.name;
            document.getElementById('linkUrl').value = link.url;
            document.getElementById('linkModalTitle').textContent = 'ì¦ê²¨ì°¾ê¸° ìˆ˜ì •';
            document.getElementById('deleteLinkBtn').style.display = 'block';
            selectedIcon = link.icon || 'ğŸ”—';
            initIconPickers();
            openModal('linkModal');
        }

        function saveLink() {
            requireAdmin(function() {
                if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
                var id = document.getElementById('linkEditId').value;
                var name = document.getElementById('linkName').value.trim();
                var url = document.getElementById('linkUrl').value.trim();
                if (!name || !url) { showToast('ì´ë¦„ê³¼ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

                var data = { name: name, url: url, icon: selectedIcon };
                if (id) {
                    db.ref('links/' + id).update(data).then(function() {
                        closeModal('linkModal');
                        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    });
                } else {
                    db.ref('links').push(data).then(function() {
                        closeModal('linkModal');
                        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    });
                }
            });
        }

        function deleteLink() {
            requireAdmin(function() {
                if (!db) return;
                var id = document.getElementById('linkEditId').value;
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                db.ref('links/' + id).remove().then(function() {
                    closeModal('linkModal');
                    showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                });
            });
        }

        // ========== ê³µì§€ì‚¬í•­ ==========
        function addNotice() {
            requireAdmin(function() {
                if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
                var title = document.getElementById('noticeTitle').value.trim();
                var content = document.getElementById('noticeContent').value.trim();
                var important = document.getElementById('noticeImportant').checked;
                if (!title || !content) { showToast('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

                db.ref('notices').push({
                    title: title, content: content, important: important,
                    date: new Date().toISOString()
                }).then(function() {
                    document.getElementById('noticeTitle').value = '';
                    document.getElementById('noticeContent').value = '';
                    document.getElementById('noticeImportant').checked = false;
                    document.getElementById('noticeAdminPanel').classList.remove('show');
                    showToast('ê³µì§€ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
                });
            });
        }

        function renderNotices() {
            var container = document.getElementById('noticeList');
            if (notices.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><p>ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            container.innerHTML = notices.map(function(n) {
                return '<div class="notice-item" onclick="openNoticeDetail(\'' + n.id + '\')"><div class="notice-header"><span class="notice-title">' + (n.important ? '<span class="notice-badge">ì¤‘ìš”</span>' : '') + n.title + '</span><span class="notice-date">' + formatDate(n.date) + '</span></div><button class="notice-delete" onclick="event.stopPropagation();deleteNotice(\'' + n.id + '\')">ğŸ—‘ï¸</button></div>';
            }).join('');
        }

        function renderRecentNotices() {
            var container = document.getElementById('recentNotices');
            var recent = notices.slice(0, 3);
            if (recent.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light)">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            container.innerHTML = recent.map(function(n) {
                return '<div class="notice-item" onclick="openNoticeDetail(\'' + n.id + '\')"><div class="notice-header"><span class="notice-title">' + (n.important ? '<span class="notice-badge">ì¤‘ìš”</span>' : '') + n.title + '</span><span class="notice-date">' + formatDate(n.date) + '</span></div></div>';
            }).join('');
        }

        function openNoticeDetail(id) {
            var n = notices.find(function(x) { return x.id === id; });
            if (!n) return;
            currentNoticeId = id;
            document.getElementById('noticeModalTitle').textContent = n.title;
            document.getElementById('noticeModalDate').textContent = formatDate(n.date);
            document.getElementById('noticeModalContent').textContent = n.content;
            renderComments(id);
            openModal('noticeModal');
        }

        function deleteNotice(id) {
            requireAdmin(function() {
                if (!db) return;
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                db.ref('notices/' + id).remove();
                db.ref('comments/' + id).remove();
                showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        // ========== ëŒ“ê¸€ ==========
        function renderComments(noticeId) {
            var container = document.getElementById('noticeComments');
            var list = comments[noticeId] || [];
            document.getElementById('commentCount').textContent = list.length > 0 ? '(' + list.length + ')' : '';

            if (list.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light)">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
                return;
            }
            container.innerHTML = list.map(function(c) {
                return '<div class="comment-item"><button class="comment-delete" onclick="deleteComment(\'' + noticeId + '\',\'' + c.id + '\')">Ã—</button><div class="comment-header"><span class="comment-author">' + c.author + '</span><span class="comment-date">' + formatDateTime(c.date) + '</span></div><p class="comment-content">' + c.content + '</p></div>';
            }).join('');
        }

        function addComment() {
            if (!db || !currentNoticeId) return;
            var author = document.getElementById('commentAuthor').value.trim() || 'ìµëª…';
            var content = document.getElementById('commentContent').value.trim();
            if (!content) { showToast('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

            db.ref('comments/' + currentNoticeId).push({
                author: author, content: content, date: new Date().toISOString()
            }).then(function() {
                document.getElementById('commentAuthor').value = '';
                document.getElementById('commentContent').value = '';
                showToast('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        function deleteComment(noticeId, commentId) {
            if (!db) return;
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            db.ref('comments/' + noticeId + '/' + commentId).remove();
        }

        // ========== ê¸°ë„ì œëª© ==========
        function updatePrayerMonth() {
            var m = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
            document.getElementById('currentMonth').textContent = currentPrayerMonth.getFullYear() + 'ë…„ ' + m[currentPrayerMonth.getMonth()];
        }

        function changeMonth(d) {
            currentPrayerMonth.setMonth(currentPrayerMonth.getMonth() + d);
            renderPrayers();
        }

        function openPrayerModal(editId) {
            document.getElementById('prayerEditId').value = '';
            document.getElementById('prayerAuthor').value = '';
            document.getElementById('prayerContent').value = '';
            document.getElementById('prayerModalTitle').textContent = 'ê¸°ë„ì œëª© ì˜¬ë¦¬ê¸°';

            if (editId) {
                var p = prayers.find(function(x) { return x.id === editId; });
                if (p) {
                    document.getElementById('prayerEditId').value = editId;
                    document.getElementById('prayerAuthor').value = p.author;
                    document.getElementById('prayerContent').value = p.content;
                    document.getElementById('prayerModalTitle').textContent = 'ê¸°ë„ì œëª© ìˆ˜ì •';
                }
            }
            openModal('prayerModal');
        }

        function savePrayer() {
            if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
            var editId = document.getElementById('prayerEditId').value;
            var author = document.getElementById('prayerAuthor').value.trim() || 'ìµëª…';
            var content = document.getElementById('prayerContent').value.trim();
            if (!content) { showToast('ê¸°ë„ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

            var monthKey = currentPrayerMonth.getFullYear() + '-' + String(currentPrayerMonth.getMonth()+1).padStart(2,'0');
            var data = { author: author, content: content, date: new Date().toISOString(), month: monthKey };

            var promise = editId ? db.ref('prayers/' + editId).update(data) : db.ref('prayers').push(data);
            promise.then(function() {
                closeModal('prayerModal');
                showToast(editId ? 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        function renderPrayers() {
            updatePrayerMonth();
            var container = document.getElementById('prayerList');
            var monthKey = currentPrayerMonth.getFullYear() + '-' + String(currentPrayerMonth.getMonth()+1).padStart(2,'0');
            var filtered = prayers.filter(function(p) { return p.month === monthKey; });

            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ™</div><p>ì´ë²ˆ ë‹¬ ê¸°ë„ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            container.innerHTML = filtered.map(function(p) {
                return '<div class="prayer-item"><div class="prayer-actions"><button onclick="openPrayerModal(\'' + p.id + '\')">âœï¸</button><button onclick="deletePrayer(\'' + p.id + '\')">ğŸ—‘ï¸</button></div><p class="prayer-author">' + p.author + '</p><p class="prayer-content">' + p.content + '</p><p class="prayer-date">' + formatDate(p.date) + '</p></div>';
            }).join('');
        }

        function deletePrayer(id) {
            if (!db) return;
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            db.ref('prayers/' + id).remove();
            showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ========== ì¼ì • ==========
        function changeCalendarMonth(d) {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + d);
            selectedDate = null;
            document.getElementById('selectedDateInfo').style.display = 'none';
            renderCalendar();
            renderSchedules();
        }

        function selectDate(year, month, day) {
            if (month !== currentCalendarMonth.getMonth() || year !== currentCalendarMonth.getFullYear()) {
                currentCalendarMonth = new Date(year, month, 1);
                renderCalendar();
                renderSchedules();
            }
            selectedDate = year + '-' + String(month+1).padStart(2,'0') + '-' + String(day).padStart(2,'0');
            renderCalendar();
            showSelectedDateSchedules();
        }

        function showSelectedDateSchedules() {
            var container = document.getElementById('selectedDateInfo');
            var schedulesDiv = document.getElementById('selectedDateSchedules');
            var titleDiv = document.getElementById('selectedDateTitle');
            
            var filtered = schedules.filter(function(s) { return s.date === selectedDate; });
            var d = new Date(selectedDate + 'T00:00:00');
            var wd = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
            
            titleDiv.textContent = 'ğŸ“… ' + (d.getMonth()+1) + 'ì›” ' + d.getDate() + 'ì¼ (' + wd[d.getDay()] + ')';
            
            if (filtered.length === 0) {
                schedulesDiv.innerHTML = '<p style="color:var(--text-light)">ì´ ë‚ ì§œì— ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                schedulesDiv.innerHTML = filtered.map(function(s) {
                    return '<div class="selected-schedule-item"><div style="font-weight:500">ğŸ“Œ ' + s.title + '</div>' + (s.time ? '<div style="font-size:0.85rem;color:var(--text-secondary)">ğŸ• ' + s.time + '</div>' : '') + '<button class="delete-btn" onclick="deleteSchedule(\'' + s.id + '\')">ğŸ—‘ï¸ ì‚­ì œ</button></div>';
                }).join('');
            }
            container.style.display = 'block';
        }

        function openQuickScheduleModal() {
            if (!selectedDate) { showToast('ë¨¼ì € ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
            var d = new Date(selectedDate + 'T00:00:00');
            var wd = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
            document.getElementById('quickScheduleTitle').textContent = 'ğŸ“… ' + (d.getMonth()+1) + 'ì›” ' + d.getDate() + 'ì¼ (' + wd[d.getDay()] + ') ì¼ì • ë“±ë¡';
            document.getElementById('quickScheduleInput').value = '';
            document.getElementById('quickScheduleTime').value = '';
            openModal('quickScheduleModal');
        }

        function saveQuickSchedule() {
            requireAdmin(function() {
                if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
                if (!selectedDate) { showToast('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
                var title = document.getElementById('quickScheduleInput').value.trim();
                var time = document.getElementById('quickScheduleTime').value.trim();
                if (!title) { showToast('ì¼ì • ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

                console.log('ì¼ì • ì €ì¥:', { date: selectedDate, title: title, time: time });
                db.ref('schedules').push({
                    date: selectedDate, title: title, time: time || ''
                }).then(function() {
                    console.log('ì €ì¥ ì„±ê³µ');
                    closeModal('quickScheduleModal');
                    showToast('ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
                }).catch(function(e) {
                    console.error('ì €ì¥ ì‹¤íŒ¨:', e);
                    showToast('ë“±ë¡ ì‹¤íŒ¨');
                });
            });
        }

        function renderCalendar() {
            var m = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
            document.getElementById('calendarMonth').textContent = currentCalendarMonth.getFullYear() + 'ë…„ ' + m[currentCalendarMonth.getMonth()];

            var grid = document.getElementById('calendarGrid');
            var year = currentCalendarMonth.getFullYear();
            var month = currentCalendarMonth.getMonth();
            var firstDay = new Date(year, month, 1).getDay();
            var totalDays = new Date(year, month+1, 0).getDate();
            var today = new Date();
            var todayStr = today.getFullYear() + '-' + String(today.getMonth()+1).padStart(2,'0') + '-' + String(today.getDate()).padStart(2,'0');
            var eventDates = schedules.map(function(s) { return s.date; });

            var html = '<div class="calendar-day-name">ì¼</div><div class="calendar-day-name">ì›”</div><div class="calendar-day-name">í™”</div><div class="calendar-day-name">ìˆ˜</div><div class="calendar-day-name">ëª©</div><div class="calendar-day-name">ê¸ˆ</div><div class="calendar-day-name">í† </div>';

            // ì´ì „ ë‹¬
            var prevMonth = month === 0 ? 11 : month - 1;
            var prevYear = month === 0 ? year - 1 : year;
            var prevLast = new Date(year, month, 0).getDate();
            for (var i = firstDay - 1; i >= 0; i--) {
                var day = prevLast - i;
                var dateStr = prevYear + '-' + String(prevMonth+1).padStart(2,'0') + '-' + String(day).padStart(2,'0');
                var hasEvent = eventDates.indexOf(dateStr) !== -1;
                html += '<div class="calendar-day other-month' + (hasEvent ? ' has-event' : '') + '" onclick="selectDate(' + prevYear + ',' + prevMonth + ',' + day + ')">' + day + '</div>';
            }

            // í˜„ì¬ ë‹¬
            for (var day = 1; day <= totalDays; day++) {
                var dateStr = year + '-' + String(month+1).padStart(2,'0') + '-' + String(day).padStart(2,'0');
                var cls = 'calendar-day';
                if (dateStr === todayStr) cls += ' today';
                if (dateStr === selectedDate) cls += ' selected';
                if (eventDates.indexOf(dateStr) !== -1) cls += ' has-event';
                if ((firstDay + day - 1) % 7 === 0) cls += ' sunday';
                html += '<div class="' + cls + '" onclick="selectDate(' + year + ',' + month + ',' + day + ')">' + day + '</div>';
            }

            // ë‹¤ìŒ ë‹¬
            var nextMonth = month === 11 ? 0 : month + 1;
            var nextYear = month === 11 ? year + 1 : year;
            var rem = 42 - (firstDay + totalDays);
            for (var d = 1; d <= rem; d++) {
                var dateStr = nextYear + '-' + String(nextMonth+1).padStart(2,'0') + '-' + String(d).padStart(2,'0');
                var hasEvent = eventDates.indexOf(dateStr) !== -1;
                html += '<div class="calendar-day other-month' + (hasEvent ? ' has-event' : '') + '" onclick="selectDate(' + nextYear + ',' + nextMonth + ',' + d + ')">' + d + '</div>';
            }

            grid.innerHTML = html;
        }

        function renderSchedules() {
            var container = document.getElementById('monthSchedules');
            var year = currentCalendarMonth.getFullYear();
            var month = currentCalendarMonth.getMonth();
            var monthKey = year + '-' + String(month+1).padStart(2,'0');
            var filtered = schedules.filter(function(s) { return s.date && s.date.indexOf(monthKey) === 0; });
            filtered.sort(function(a, b) { return a.date.localeCompare(b.date); });
            var wd = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];

            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“…</div><p>ì´ë²ˆ ë‹¬ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }

            container.innerHTML = filtered.map(function(s) {
                var d = new Date(s.date + 'T00:00:00');
                return '<div class="schedule-item"><div class="schedule-date"><div class="schedule-day">' + d.getDate() + '</div><div class="schedule-weekday">' + wd[d.getDay()] + '</div></div><div class="schedule-info"><div class="schedule-title">' + s.title + '</div>' + (s.time ? '<div class="schedule-time">ğŸ• ' + s.time + '</div>' : '') + '</div><button class="delete-btn" onclick="deleteSchedule(\'' + s.id + '\')">ğŸ—‘ï¸</button></div>';
            }).join('');
        }

        function deleteSchedule(id) {
            requireAdmin(function() {
                if (!db) return;
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                db.ref('schedules/' + id).remove().then(function() {
                    showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                });
            });
        }

        // ========== ë¶€ì„œ ==========
        function renderDeptTabs() {
            var container = document.getElementById('deptTabs');
            if (departments.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light)">ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤. "ë¶€ì„œ ê´€ë¦¬"ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</p>';
                return;
            }
            container.innerHTML = departments.map(function(d) {
                return '<button class="dept-tab' + (currentDept === d.id ? ' active' : '') + '" onclick="switchDept(\'' + d.id + '\')">' + (d.icon || 'ğŸ‘¥') + ' ' + d.name + '</button>';
            }).join('');
        }

        function updateDeptSelect() {
            var select = document.getElementById('deptPostDept');
            if (departments.length > 0) {
                select.innerHTML = departments.map(function(d) { return '<option value="' + d.id + '">' + d.name + '</option>'; }).join('');
            } else {
                select.innerHTML = '<option value="">ë¶€ì„œë¥¼ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”</option>';
            }
        }

        function switchDept(id) {
            currentDept = id;
            renderDeptTabs();
            renderDeptPosts();
        }

        function openDeptManageModal() {
            renderDeptManageList();
            openModal('deptManageModal');
        }

        function renderDeptManageList() {
            var container = document.getElementById('deptManageList');
            if (departments.length === 0) {
                container.innerHTML = '<p style="color:var(--text-light); text-align:center;">ë“±ë¡ëœ ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            container.innerHTML = departments.map(function(d) {
                return '<div class="dept-manage-item"><div class="dept-manage-info"><span class="dept-manage-icon">' + (d.icon || 'ğŸ‘¥') + '</span><span class="dept-manage-name">' + d.name + '</span></div><div class="dept-manage-actions"><button class="dept-edit-btn" onclick="editDept(\'' + d.id + '\')">âœï¸ ìˆ˜ì •</button><button class="dept-delete-btn" onclick="deleteDept(\'' + d.id + '\')">ğŸ—‘ï¸ ì‚­ì œ</button></div></div>';
            }).join('');
        }

        function openDeptAddModal() {
            document.getElementById('deptEditId').value = '';
            document.getElementById('deptName').value = '';
            document.getElementById('deptModalTitle').textContent = 'ë¶€ì„œ ì¶”ê°€';
            selectedDeptIcon = 'ğŸ‘”';
            initIconPickers();
            openModal('deptModal');
        }

        function editDept(id) {
            var dept = departments.find(function(d) { return d.id === id; });
            if (!dept) return;
            document.getElementById('deptEditId').value = id;
            document.getElementById('deptName').value = dept.name;
            document.getElementById('deptModalTitle').textContent = 'ë¶€ì„œ ìˆ˜ì •';
            selectedDeptIcon = dept.icon || 'ğŸ‘”';
            initIconPickers();
            closeModal('deptManageModal');
            openModal('deptModal');
        }

        function saveDept() {
            requireAdmin(function() {
                if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
                var id = document.getElementById('deptEditId').value;
                var name = document.getElementById('deptName').value.trim();
                if (!name) { showToast('ë¶€ì„œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

                console.log('ë¶€ì„œ ì €ì¥:', { id: id, name: name, icon: selectedDeptIcon });

                if (id) {
                    db.ref('departments/' + id).update({ name: name, icon: selectedDeptIcon }).then(function() {
                        console.log('ë¶€ì„œ ìˆ˜ì • ì„±ê³µ');
                        closeModal('deptModal');
                        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    }).catch(function(e) {
                        console.error('ë¶€ì„œ ìˆ˜ì • ì‹¤íŒ¨:', e);
                        showToast('ì €ì¥ ì‹¤íŒ¨');
                    });
                } else {
                    db.ref('departments').push({ name: name, icon: selectedDeptIcon, order: departments.length + 1 }).then(function() {
                        console.log('ë¶€ì„œ ì¶”ê°€ ì„±ê³µ');
                        closeModal('deptModal');
                        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                    }).catch(function(e) {
                        console.error('ë¶€ì„œ ì¶”ê°€ ì‹¤íŒ¨:', e);
                        showToast('ì €ì¥ ì‹¤íŒ¨');
                    });
                }
            });
        }

        function deleteDept(id) {
            requireAdmin(function() {
                if (!db) return;
                if (!confirm('ì´ ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                db.ref('departments/' + id).remove();
                db.ref('deptPosts/' + id).remove();
                renderDeptManageList();
                showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        function togglePasswordField() {
            var checkbox = document.getElementById('deptPostLocked');
            var field = document.getElementById('passwordField');
            field.classList.toggle('active', checkbox.checked);
        }

        function renderDeptPosts() {
            var container = document.getElementById('deptContents');
            if (departments.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘¥</div><p>ë¶€ì„œë¥¼ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš”</p></div>';
                return;
            }
            if (!currentDept) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘†</div><p>ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p></div>';
                return;
            }
            var posts = deptPosts[currentDept] || [];
            if (posts.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“</div><p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }

            container.innerHTML = posts.map(function(p) {
                return '<div class="dept-post' + (p.locked ? ' locked' : '') + '" onclick="openDeptPostDetail(\'' + currentDept + '\',\'' + p.id + '\')"><div class="dept-post-header"><span class="dept-post-title">' + (p.locked ? '<span class="lock-icon">ğŸ”’</span>' : '') + p.title + '</span><span class="dept-post-date">' + formatDate(p.date) + '</span></div><p class="dept-post-preview">' + (p.locked ? 'ğŸ” ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤' : (p.content.length > 100 ? p.content.substring(0,100) + '...' : p.content)) + '</p><button class="delete-btn" onclick="event.stopPropagation();deleteDeptPost(\'' + currentDept + '\',\'' + p.id + '\')">ğŸ—‘ï¸ ì‚­ì œ</button></div>';
            }).join('');
        }

        function openDeptPostDetail(deptId, postId) {
            var posts = deptPosts[deptId] || [];
            var post = posts.find(function(p) { return p.id === postId; });
            if (!post) return;

            if (post.locked && post.password) {
                pendingPost = { deptId: deptId, post: post };
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordError').classList.remove('show');
                openModal('passwordModal');
            } else {
                showDeptPostContent(post);
            }
        }

        function showDeptPostContent(post) {
            document.getElementById('deptPostModalTitle').textContent = post.title;
            document.getElementById('deptPostModalBody').innerHTML = '<p style="color:var(--text-light); margin-bottom: 16px;">' + formatDateTime(post.date) + '</p><div style="line-height: 1.8; white-space: pre-wrap;">' + post.content + '</div>';
            openModal('deptPostModal');
        }

        function checkPassword() {
            if (!pendingPost) return;
            var input = document.getElementById('passwordInput').value;
            if (input === pendingPost.post.password) {
                closeModal('passwordModal');
                showDeptPostContent(pendingPost.post);
                pendingPost = null;
            } else {
                document.getElementById('passwordError').classList.add('show');
                document.getElementById('passwordInput').value = '';
            }
        }

        function addDeptPost() {
            requireAdmin(function() {
                if (!db) { showToast('ì—°ê²° ì‹¤íŒ¨'); return; }
                var deptId = document.getElementById('deptPostDept').value;
                if (!deptId) { showToast('ë¶€ì„œë¥¼ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš”'); return; }
                var title = document.getElementById('deptPostTitle').value.trim();
                var content = document.getElementById('deptPostContent').value.trim();
                var locked = document.getElementById('deptPostLocked').checked;
                var password = document.getElementById('deptPostPassword').value.trim();
                if (!title || !content) { showToast('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
                if (locked && !password) { showToast('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

                db.ref('deptPosts/' + deptId).push({
                    title: title, content: content, date: new Date().toISOString(),
                    locked: locked, password: locked ? password : null
                }).then(function() {
                    document.getElementById('deptPostTitle').value = '';
                    document.getElementById('deptPostContent').value = '';
                    document.getElementById('deptPostLocked').checked = false;
                    document.getElementById('deptPostPassword').value = '';
                    document.getElementById('passwordField').classList.remove('active');
                    document.getElementById('deptAdminPanel').classList.remove('show');
                    showToast('ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
                });
            });
        }

        function deleteDeptPost(deptId, postId) {
            requireAdmin(function() {
                if (!db) return;
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                db.ref('deptPosts/' + deptId + '/' + postId).remove();
                showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }
    </script>
</body>
</html>
